<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aldo & Isabella — Wedding</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Montserrat:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        page: 'rgb(241, 235, 235)',
                        text: '#3A3836',
                        accent: '#C4B4A4',
                        card: '#FFFFFF',
                        wedding: 'rgb(170, 180, 156)'
                    },
                    fontFamily: {
                        serif: ['"EB Garamond"', 'serif'],
                        sans: ['Montserrat', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        body {
            background-color: theme('colors.page');
            color: theme('colors.text');
        }

        .hidden {
            display: none !important;
        }

        /* Timeline styling */
        .timeline-item::after {
            content: '';
            position: absolute;
            left: 15px;
            top: 36px;
            bottom: -8px;
            width: 2px;
            background-color: #E5E0D8;
            z-index: 0;
        }

        .timeline-item:last-child::after {
            display: none;
        }
    </style>
</head>

<body class="font-sans antialiased flex flex-col min-h-screen bg-page text-text">

    <!-- Navigation -->
    <nav class="fixed w-full z-50 bg-wedding text-white shadow-md">
        <div
            class="max-w-5xl mx-auto px-4 py-3 md:px-6 md:py-4 flex flex-wrap justify-center gap-3 md:gap-6 text-xs md:text-sm uppercase tracking-widest font-medium">
            <a href="#home" class="hover:opacity-80 transition-opacity">Home</a>
            <a href="#story" class="hover:opacity-80 transition-opacity">Our Story</a>
            <a href="#schedule" class="hover:opacity-80 transition-opacity">Schedule</a>
            <a href="#details" class="hover:opacity-80 transition-opacity">Details</a>
            <a href="#registry" class="hover:opacity-80 transition-opacity">Registry</a>
            <a href="#rsvp" class="hover:opacity-80 transition-opacity font-bold">RSVP</a>
        </div>
    </nav>

    <!-- Home Section -->
    <section id="home"
        class="min-h-screen flex flex-col items-center justify-center text-center px-4 md:px-6 pt-24 pb-12">
        <h1 class="font-serif text-5xl sm:text-6xl md:text-8xl mb-4 md:mb-6">Aldo & Isabella</h1>
        <img src="gallery/image1.png" alt="Aldo and Isabella"
            class="w-full max-w-lg mx-auto h-48 sm:h-64 md:h-96 object-cover rounded-sm shadow-lg mb-6">
        <p class="text-lg sm:text-xl md:text-2xl font-serif italic mb-2">January 16, 2027</p>
        <p class="text-xs sm:text-sm md:text-md uppercase tracking-widest mb-8">The Plaza Hotel at Pioneer Park<br>El
            Paso, TX</p>

        <a href="https://www.google.com/maps?q=106+W+Mills+Ave,+El+Paso,+TX+79901" target="_blank"
            class="bg-wedding text-white px-6 py-3 md:px-8 md:py-3 rounded-sm uppercase tracking-widest text-xs md:text-sm hover:opacity-90 transition-opacity mb-12 md:mb-16 shadow-md">
            Directions
        </a>

        <div class="mt-4 md:mt-8 text-center">
            <p class="font-serif text-xl md:text-2xl italic mb-4 md:mb-6">Let the Countdown begin</p>
            <div id="countdown"
                class="flex gap-3 sm:gap-4 md:gap-8 justify-center uppercase tracking-widest text-[10px] sm:text-xs font-bold">
                <div class="flex flex-col items-center"><span id="days"
                        class="text-3xl md:text-4xl font-serif font-normal mb-1">00</span>Days</div>
                <div class="flex flex-col items-center"><span id="hours"
                        class="text-3xl md:text-4xl font-serif font-normal mb-1">00</span>Hours</div>
                <div class="flex flex-col items-center"><span id="mins"
                        class="text-3xl md:text-4xl font-serif font-normal mb-1">00</span>Minutes</div>
                <div class="flex flex-col items-center"><span id="secs"
                        class="text-3xl md:text-4xl font-serif font-normal mb-1">00</span>Seconds</div>
            </div>
        </div>
    </section>

    <!-- Our Story Section -->
    <section id="story" class="py-16 md:py-24 px-4 md:px-6">
        <div class="max-w-5xl mx-auto grid md:grid-cols-2 gap-8 md:gap-12 items-center">
            <div class="order-2 md:order-1">
                <div class="text-center md:text-left mb-6">
                    <h2 class="font-serif text-4xl md:text-5xl">Our Love Story</h2>
                </div>
                <p class="text-base md:text-lg leading-relaxed text-gray-600 mb-4 text-center md:text-left">
                    Welcome to our beginning. We are so thrilled to share this special milestone with our favorite
                    people.
                    From our first date to this beautiful commitment, every moment has led us here.
                </p>
                <p class="text-base md:text-lg leading-relaxed text-gray-600 text-center md:text-left">
                    We can't wait to celebrate our love story surrounded by the friends and family who mean the world to
                    us.
                </p>
            </div>
            <div class="order-1 md:order-2 grid grid-cols-2 gap-2 sm:gap-4">
                <img src="gallery/image2.png" alt="Our Story 1"
                    class="w-full h-32 sm:h-48 md:h-64 object-cover rounded-sm shadow-lg">
                <img src="gallery/image3.png" alt="Our Story 2"
                    class="w-full h-32 sm:h-48 md:h-64 object-cover rounded-sm shadow-lg">
                <img src="gallery/image4.png" alt="Our Story 3"
                    class="w-full h-40 sm:h-64 md:h-80 object-cover rounded-sm shadow-lg col-span-2">
            </div>
        </div>
    </section>

    <!-- Schedule Section -->
    <section id="schedule" class="py-16 md:py-24 px-4 md:px-6">
        <div class="max-w-3xl mx-auto">
            <div class="text-center mb-12 md:mb-16">
                <h2 class="font-serif text-4xl md:text-5xl">Schedule</h2>
            </div>
            <div class="relative pl-2 sm:pl-6 md:pl-0">
                <div class="md:w-1/2 md:ml-auto relative timeline-item pb-10 md:pb-12 pl-12">
                    <div class="absolute left-0 top-0 w-8 h-8 flex items-center justify-center bg-page z-10">
                        <img src="gallery/icon1.png" alt="Ceremony" class="w-8 h-8 object-contain">
                    </div>
                    <h3 class="font-serif text-2xl mb-1">Ceremony</h3>
                    <p class="text-sm uppercase tracking-widest text-gray-500">04:00 PM</p>
                </div>
                <div class="md:w-1/2 md:ml-auto relative timeline-item pb-10 md:pb-12 pl-12">
                    <div class="absolute left-0 top-0 w-8 h-8 flex items-center justify-center bg-page z-10">
                        <img src="gallery/icon2.png" alt="Cocktail" class="w-8 h-8 object-contain">
                    </div>
                    <h3 class="font-serif text-2xl mb-1">Cocktail</h3>
                    <p class="text-sm uppercase tracking-widest text-gray-500">05:00 PM</p>
                </div>
                <div class="md:w-1/2 md:ml-auto relative timeline-item pb-10 md:pb-12 pl-12">
                    <div class="absolute left-0 top-0 w-8 h-8 flex items-center justify-center bg-page z-10">
                        <img src="gallery/icon3.png" alt="Dinner" class="w-8 h-8 object-contain">
                    </div>
                    <h3 class="font-serif text-2xl mb-1">Dinner</h3>
                    <p class="text-sm uppercase tracking-widest text-gray-500">06:30 PM</p>
                </div>
                <div class="md:w-1/2 md:ml-auto relative timeline-item pb-10 md:pb-12 pl-12">
                    <div class="absolute left-0 top-0 w-8 h-8 flex items-center justify-center bg-page z-10">
                        <img src="gallery/icon4.png" alt="Party" class="w-8 h-8 object-contain">
                    </div>
                    <h3 class="font-serif text-2xl mb-1">Party</h3>
                    <p class="text-sm uppercase tracking-widest text-gray-500">08:00 PM</p>
                </div>
                <div class="md:w-1/2 md:ml-auto relative timeline-item pb-10 md:pb-12 pl-12">
                    <div class="absolute left-0 top-0 w-8 h-8 flex items-center justify-center bg-page z-10">
                        <img src="gallery/icon5.png" alt="Cake Cutting" class="w-8 h-8 object-contain">
                    </div>
                    <h3 class="font-serif text-2xl mb-1">Cake Cutting</h3>
                    <p class="text-sm uppercase tracking-widest text-gray-500">09:30 PM</p>
                </div>
                <div class="md:w-1/2 md:ml-auto relative timeline-item pl-12">
                    <div class="absolute left-0 top-0 w-8 h-8 flex items-center justify-center bg-page z-10">
                        <img src="gallery/icon6.png" alt="Homeline" class="w-8 h-8 object-contain">
                    </div>
                    <h3 class="font-serif text-2xl mb-1">Homeline</h3>
                    <p class="text-sm uppercase tracking-widest text-gray-500">11:00 PM</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Details Section -->
    <section id="details" class="py-16 md:py-24 px-4 md:px-6">
        <div class="max-w-5xl mx-auto text-center">
            <div class="mb-12">
                <h2 class="font-serif text-4xl md:text-5xl">Details</h2>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 md:gap-8 mb-8 md:mb-12">
                <div class="p-6 bg-white rounded-sm shadow-sm border border-[#E5E0D8]">
                    <h3 class="font-serif text-xl mb-2">Parking</h3>
                    <p class="text-sm text-gray-600">Onsite Valet parking is available at the hotel.</p>
                </div>
                <div class="p-6 bg-white rounded-sm shadow-sm border border-[#E5E0D8]">
                    <h3 class="font-serif text-xl mb-2">Dress Code</h3>
                    <p class="text-sm text-gray-600">Formal attire. Please dress to impress for our special night.</p>
                </div>
                <div class="p-6 bg-white rounded-sm shadow-sm border border-[#E5E0D8]">
                    <h3 class="font-serif text-xl mb-2">Hotel Discount</h3>
                    <p class="text-sm text-gray-600">Discount code for rooms: AIWEDDING</p>
                </div>
            </div>

            <div class="bg-white p-6 md:p-10 rounded-sm shadow-sm border border-[#E5E0D8] flex flex-col items-center">
                <h3 class="font-serif text-3xl mb-2">Vision Board</h3>
                <p class="text-sm text-gray-600 mb-8">Check your invitation for color palette inspiration.</p>
                <img src="gallery/image5.png" alt="Vision Board"
                    class="w-full max-w-4xl h-auto object-contain rounded-sm shadow-sm">
            </div>
        </div>
    </section>

    <!-- Registry Section -->
    <section id="registry" class="py-16 md:py-24 px-4 md:px-6 text-center">
        <div
            class="max-w-3xl mx-auto bg-white/95 backdrop-blur-sm p-8 md:p-12 rounded-sm shadow-md border border-[#E5E0D8]">
            <div class="mb-8">
                <h2 class="font-serif text-4xl md:text-5xl">Gift Registry</h2>
            </div>
            <p class="text-lg md:text-xl font-serif italic mb-4 md:mb-6">Your presence is truly the best gift we could
                ask for!</p>
            <p class="text-sm md:text-md text-gray-600 mb-8 md:mb-12 leading-relaxed max-w-xl mx-auto">
                Since we're already settled in our home out of state, we've decided not to have a traditional gift
                registry.
                If you wish to bless us with a gift, cash gifts are incredibly appreciated.
            </p>

            <div class="flex flex-col sm:flex-row justify-center gap-6 max-w-2xl mx-auto">
                <!-- Cashbox -->
                <div
                    class="flex-1 bg-white p-8 rounded-sm shadow-sm border border-[#E5E0D8] flex flex-col items-center justify-center text-center">
                    <svg class="w-10 h-10 text-wedding mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                        </path>
                    </svg>
                    <h3 class="font-serif text-2xl mb-2 text-text">Cashbox</h3>
                    <p class="text-xs uppercase tracking-widest text-gray-500">Day of the wedding</p>
                </div>

                <!-- Transfer Money -->
                <div class="flex-1 bg-white p-8 rounded-sm shadow-sm border border-[#E5E0D8] flex flex-col items-center justify-center text-center cursor-pointer hover:border-wedding hover:shadow-md transition-all group"
                    onclick="toggleTransferDetails()">
                    <svg class="w-10 h-10 text-wedding mb-4 group-hover:scale-110 transition-transform" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                        </path>
                    </svg>
                    <h3 class="font-serif text-2xl mb-2 text-text">Transfer Money</h3>
                    <p class="text-xs uppercase tracking-widest text-gray-500">Click for details</p>
                </div>
            </div>

            <!-- Hidden Details Box -->
            <div id="transfer-details"
                class="hidden mt-6 max-w-2xl mx-auto bg-page p-6 rounded-sm border border-[#E5E0D8] shadow-inner text-center transition-all">
                <div class="flex flex-col sm:flex-row justify-around gap-6">
                    <div class="flex-1">
                        <p class="font-bold text-sm uppercase tracking-widest text-wedding mb-2">CashApp</p>
                        <p class="text-lg font-serif text-text">$AldoSanchezzz</p>
                    </div>
                    <div class="hidden sm:block w-px bg-[#E5E0D8]"></div>
                    <div class="flex-1">
                        <p class="font-bold text-sm uppercase tracking-widest text-wedding mb-2">Zelle</p>
                        <p class="text-lg font-serif text-text">915-503-4696</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- RSVP Section -->
    <section id="rsvp" class="py-16 md:py-24 px-4 md:px-6 border-t border-[#E5E0D8]">
        <div class="max-w-2xl mx-auto bg-white p-6 md:p-12 rounded-sm shadow-md border border-[#E5E0D8]">
            <div class="text-center mb-8">
                <h2 class="font-serif text-4xl md:text-5xl">RSVP</h2>
            </div>

            <div id="rsvp-root">
                <!-- Lookup Form -->
                <div id="lookup">
                    <h3 class="font-serif text-2xl mb-4 text-center">Have an invitation code?</h3>
                    <form id="lookup-form" class="flex flex-col gap-4">
                        <label for="inviteCode" class="text-sm font-bold uppercase tracking-widest text-center">Enter
                            the personalized code from your invitation.</label>
                        <input id="inviteCode" name="code" type="text" required placeholder="e.g. ABC123"
                            class="p-3 border border-gray-300 rounded-sm focus:outline-none focus:border-wedding text-center bg-page">
                        <button type="button" onclick="handleLookup()"
                            class="bg-wedding text-white p-3 rounded-sm uppercase tracking-widest text-sm hover:opacity-90 transition-opacity mt-2 shadow-sm">Enter</button>
                    </form>
                </div>

                <p id="loading" class="hidden text-center text-gray-600 py-8">Looking up your invitation...</p>

                <div id="not-found" class="hidden text-center py-8">
                    <h3 class="font-serif text-2xl mb-2 text-red-600">Invitation not found</h3>
                    <p class="text-sm text-gray-600">Sorry, we could not find your invitation code. Please double-check
                        or contact us at <a href="mailto:aldo.y.isabella@gmail.com"
                            class="underline">aldo.y.isabella@gmail.com</a>.</p>
                    <button type="button" onclick="resetLookup()"
                        class="mt-6 text-sm underline uppercase tracking-widest text-gray-500 hover:text-wedding transition-colors">Try
                        Again</button>
                </div>

                <!-- Main RSVP Form -->
                <form id="rsvp-form" class="hidden flex flex-col gap-6">
                    <p id="welcome" class="font-serif text-2xl text-center border-b border-gray-300 pb-4">...</p>

                    <input type="hidden" name="UniqueCode" id="field-code">
                    <input type="hidden" name="GroupName" id="field-group">

                    <div class="flex flex-col gap-2">
                        <label for="guestCount" class="font-bold text-xs md:text-sm uppercase tracking-widest">Total
                            guests attending</label>
                        <input id="guestCount" name="GuestCount" type="number" min="0" value="1" required
                            class="p-3 border border-gray-300 rounded-sm focus:outline-none focus:border-wedding bg-page">
                    </div>

                    <fieldset id="ceremony-fieldset" class="border border-gray-200 p-4 rounded-sm bg-page">
                        <legend
                            class="font-bold text-xs md:text-sm uppercase tracking-widest px-2 text-gray-700 bg-white">
                            Will you attend the ceremony?</legend>
                        <div class="flex flex-col sm:flex-row gap-3 sm:gap-6 mt-3">
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio"
                                    id="attendCeremonyYes" name="AttendCeremony" value="Yes" checked
                                    class="accent-wedding"> Yes</label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio"
                                    id="attendCeremonyNo" name="AttendCeremony" value="No" class="accent-wedding">
                                No</label>
                        </div>
                    </fieldset>

                    <fieldset id="reception-fieldset" class="border border-gray-200 p-4 rounded-sm bg-page">
                        <legend
                            class="font-bold text-xs md:text-sm uppercase tracking-widest px-2 text-gray-700 bg-white">
                            Will you attend the reception?</legend>
                        <div class="flex flex-col sm:flex-row gap-3 sm:gap-6 mt-3">
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio"
                                    id="attendReceptionYes" name="AttendReception" value="Yes" checked
                                    class="accent-wedding"> Yes</label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio"
                                    id="attendReceptionNo" name="AttendReception" value="No" class="accent-wedding">
                                No</label>
                        </div>
                    </fieldset>

                    <fieldset class="border border-gray-200 p-4 rounded-sm bg-page">
                        <legend
                            class="font-bold text-xs md:text-sm uppercase tracking-widest px-2 text-gray-700 bg-white">
                            Are you vegetarian?</legend>
                        <div class="flex flex-col sm:flex-row gap-3 sm:gap-6 mt-3">
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="Vegetarian"
                                    value="Yes" class="accent-wedding"> Yes</label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="Vegetarian"
                                    value="No" checked class="accent-wedding"> No</label>
                        </div>
                    </fieldset>

                    <div class="flex flex-col gap-2">
                        <label for="notes" class="font-bold text-xs md:text-sm uppercase tracking-widest">Notes
                            (optional)</label>
                        <textarea id="notes" name="Notes" rows="3"
                            placeholder="Song requests, accessibility needs, etc."
                            class="p-3 border border-gray-300 rounded-sm focus:outline-none focus:border-wedding bg-page"></textarea>
                    </div>

                    <p id="form-msg" class="text-center font-bold text-sm"></p>

                    <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 mt-4">
                        <button type="submit"
                            class="w-full sm:flex-1 bg-wedding text-white p-3 rounded-sm uppercase tracking-widest text-xs md:text-sm hover:opacity-90 transition-opacity shadow-sm">Submit
                            RSVP</button>
                        <button type="button" id="cancelBtn" onclick="resetLookup()"
                            class="w-full sm:flex-1 bg-gray-200 text-text p-3 rounded-sm uppercase tracking-widest text-xs md:text-sm hover:bg-gray-300 transition-colors">Cancel</button>
                    </div>
                </form>
            </div>

            <p class="text-center text-[10px] md:text-xs text-gray-500 mt-8 md:mt-12">If you didn't receive a code,
                please contact us at <a href="mailto:aldo.y.isabella@gmail.com"
                    class="underline">aldo.y.isabella@gmail.com</a>.</p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-text text-white py-8 text-center">
        <p class="font-serif text-lg">Aldo & Isabella — January 16, 2027</p>
    </footer>

    <!-- Scripts -->
    <script>
        function toggleTransferDetails() {
            const details = document.getElementById('transfer-details');
            details.classList.toggle('hidden');
        }

        // Countdown Logic
        const targetDate = new Date("January 16, 2027 16:00:00").getTime();

        const countdownTimer = setInterval(() => {
            const now = new Date().getTime();
            const distance = targetDate - now;

            if (distance < 0) {
                clearInterval(countdownTimer);
                document.getElementById("countdown").innerHTML = "TODAY IS THE DAY!";
                return;
            }

            document.getElementById("days").innerText = Math.floor(distance / (1000 * 60 * 60 * 24)).toString().padStart(2, '0');
            document.getElementById("hours").innerText = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
            document.getElementById("mins").innerText = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
            document.getElementById("secs").innerText = Math.floor((distance % (1000 * 60)) / 1000).toString().padStart(2, '0');
        }, 1000);

        // RSVP Logic
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwCmS-12Ba1242022ahM5Rl9hUgVSKXlpdLPUqead2E0BmOm02EMKYb1HikZrsEH1RA/exec";
        let currentGuestMax = 1;

        function show(id) { document.getElementById(id).classList.remove('hidden'); }
        function hide(id) { document.getElementById(id).classList.add('hidden'); }

        function resetLookup() {
            hide('rsvp-form');
            hide('not-found');
            hide('loading');
            show('lookup');
            document.getElementById('inviteCode').value = '';
            document.getElementById('form-msg').innerText = '';
        }

        async function fetchGuestList() {
            const resp = await fetch('guestlist.json.b64', { cache: "no-store" });
            if (!resp.ok) throw new Error('Failed to fetch');
            const b64 = (await resp.text()).trim();
            try {
                return JSON.parse(atob(b64));
            } catch (err) {
                const bin = atob(b64);
                const bytes = new Uint8Array(bin.length);
                for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);
                return JSON.parse(new TextDecoder('utf-8').decode(bytes));
            }
        }

        async function handleLookup() {
            const code = document.getElementById('inviteCode').value.trim();
            if (!code) return;

            hide('lookup');
            show('loading');

            try {
                const guestList = await fetchGuestList();
                const entry = guestList.find(g => String(g.UniqueCode).toLowerCase() === code.toLowerCase());

                hide('loading');

                if (!entry) {
                    show('not-found');
                    return;
                }

                show('rsvp-form');
                document.getElementById('field-code').value = entry.UniqueCode;
                document.getElementById('field-group').value = entry.GroupName;
                document.getElementById('welcome').innerText = `Welcome ${entry.GroupName}!`;

                const ceremonyFieldset = document.getElementById('ceremony-fieldset');
                const ceremonyYes = document.getElementById('attendCeremonyYes');
                const ceremonyNo = document.getElementById('attendCeremonyNo');

                if (entry.InvitedToCeremony !== true) {
                    hide('ceremony-fieldset');
                    ceremonyYes.disabled = true;
                    ceremonyNo.checked = true;
                    ceremonyNo.disabled = true;
                } else {
                    show('ceremony-fieldset');
                    ceremonyYes.disabled = false;
                    ceremonyNo.disabled = false;
                }

                currentGuestMax = parseInt(entry.MaxAllowedGuests || 1, 10);
                const guestInput = document.getElementById('guestCount');
                guestInput.max = currentGuestMax;
                guestInput.value = Math.min(currentGuestMax, 1);

                window.location.hash = "rsvp";
            } catch (err) {
                hide('loading');
                show('not-found');
                console.error(err);
            }
        }

        document.getElementById('guestCount').addEventListener('input', (e) => {
            const val = parseInt(e.target.value || 0, 10);
            const msg = document.getElementById('form-msg');
            if (val > currentGuestMax) msg.innerText = `Maximum allowed is ${currentGuestMax} guests.`;
            else msg.innerText = '';
        });

        document.getElementById('rsvp-form').addEventListener('submit', async (ev) => {
            ev.preventDefault();
            const msg = document.getElementById('form-msg');
            const guestCount = parseInt(document.getElementById('guestCount').value || 0, 10);
            const attendCeremony = document.querySelector('input[name="AttendCeremony"]:checked')?.value === "Yes";
            const attendReception = document.querySelector('input[name="AttendReception"]:checked')?.value === "Yes";

            if (guestCount < 0 || guestCount > currentGuestMax) {
                msg.innerText = `Guest count must be between 0 and ${currentGuestMax}.`;
                return;
            }
            if (guestCount > 0 && !(attendCeremony || attendReception)) {
                msg.innerText = 'Please select at least one event.';
                return;
            }

            msg.innerText = "Submitting...";
            msg.className = "text-center font-bold text-sm text-gray-600 mt-2";

            const payload = {
                UniqueCode: document.getElementById('field-code').value,
                GroupName: document.getElementById('field-group').value,
                AttendCeremony: attendCeremony ? "Yes" : "No",
                AttendReception: attendReception ? "Yes" : "No",
                GuestCount: guestCount,
                Vegetarian: document.querySelector('input[name="Vegetarian"]:checked')?.value || "No",
                Notes: document.getElementById('notes').value
            };

            try {
                const res = await fetch(SCRIPT_URL, {
                    method: "POST",
                    body: JSON.stringify(payload),
                    headers: { "Content-Type": "text/plain;charset=utf-8" }
                });

                if (res.ok) {
                    msg.innerText = "✅ Thank you! Your RSVP has been recorded.";
                    msg.className = "text-center font-bold text-sm text-green-600 mt-2";
                    document.getElementById('rsvp-form').reset();
                } else {
                    msg.innerText = "❌ Submission failed. Try again.";
                    msg.className = "text-center font-bold text-sm text-red-600 mt-2";
                }
            } catch (err) {
                msg.innerText = "❌ Network error. Try again later.";
                msg.className = "text-center font-bold text-sm text-red-600 mt-2";
            }
        });

        // Automatically load RSVP form if "code" is in URL
        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const code = params.get('code');
            if (code) {
                document.getElementById('inviteCode').value = code;
                handleLookup();
                setTimeout(() => window.location.hash = "rsvp", 500);
            }
        });
    </script>
</body>

</html>